# tritask-sta 開発ドキュメント

## 設計など

### tritaファイル
tritask-sta は .trita ファイルを扱うようになっている。

逆を言うと .txt や .md など他のテキストファイル形式に書いたタスクを処理することは想定していない。あくまでも trita ファイルに書かれたタスクだけを処理するものと想定している。

たとえば Editor Layer では「trita ファイルでない場合は処理を中止する」などのガードを入れている。

### Editor Layer と Helper Layer
trita ファイルを処理するレイヤーが二つある。

- Editor Layer …… 秀丸エディタマクロ(tritask.mac)側で処理する
- Helper Layer …… helper.py 側で処理する

基本的に Editor Layer で処理するのが望ましいが、マクロの機能では限界があるため Helper Layer も用意している。ソートや属性などメインの処理はほとんど Helper である。Editor 側では「カーソルを動かす」「現在カーソル位置に文字列を挿入する」など edit 操作をしている程度。

Helper Layer の実行は、Editor Layer から「外部プログラムを呼び出す機能」を使って「Helper をコマンドライン引数つきで呼び出す」ことで行われる。

### helper.py
- 一ファイルで実装し、複数ファイルには分けない
    - Editor Layer からの呼び出しを簡単にするため
- 標準ライブラリ以外は使わない
    - 利用者が「Python 環境を入れただけで」使えるようにするため
    - 利用者に「pip で別途ライブラリ ABC をインストールしてね」などとするのは易しくない
- 実行ファイル化は当面検討していない
    - py ファイルのままでも性能に問題はない
    - 作者個人としては py ファイルの方が直接編集できて利便性が高い
    - そのうちやりたいとは思っている(これができれば利用者は Python がなくても済むようになる)

### hilight
- 秀丸エディタのシンタックスハイライト用ファイル
- 以下がある
    - trita.hilight（初期から存在するテーマ）（白背景なので眩しい）
    - trita_dark.hilight（ダークテーマ）（2020/06/10 現在作者はこちらを愛用）
- 適用しなくても tritask-sta は動くが、適用すれば色が付き、見やすくなる
- 色の設計は完全に作者の主観に基づく
    - 色に関する特別な知識や感覚にも基づいておらず、「見やすいしこれでいいか」程度に適当に決めている
    - 気に食わない場合は、各自自製してほしい
- 作成方法
    - 1: 秀丸エディタ側の設定画面(ファイルタイプ別の設定)でカスタマイズする
    - 2: 保存ボタンから保存する

## ログ
helper.py でエラーが出た場合に、tritask.log を吐くようにしている。

例外をそのまま吐いているだけであり情報はあまり多くない。無いよりはマシという程度。

## テスト

### ユニットテスト

```terminal
$ python test_helper.py
..........
----------------------------------------------------------------------
Ran 10 tests in 0.016s

OK
```

### その他のテスト
tritaファイルをつくって適当に行う。

## ビルド
- 1: build.bat を叩くことで、tritask-sta フォルダが出来上がる
- 2: 1のフォルダをzipに固める（これをリリースする）

## ドキュメンテーション

### 主なドキュメント
以下がある。

- README
- specification
- CHANGELOG

いずれも手動更新。

### バージョン番号
以下に記載している。

- helper.py
- CHANGELOG
- specification

いずれも手動更新。
